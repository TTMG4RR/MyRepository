<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>CORS è”è°ƒéªŒè¯ğŸ˜‹</title>
</head>
<body>
<h1>è·¨åŸŸè¯·æ±‚ç¤ºä¾‹ğŸŒµğŸŒµğŸŒµ</h1>
<button id="loginBtn">ç™»å½•è·å–tokenğŸ¥³</button>
<br><br>
<button id="fetchBtn">è·å–æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨ğŸ˜</button>
<pre id="result"></pre>

<script>
    const baseUrl = 'http://localhost:8080/api/user';

    // ç™»å½•é€»è¾‘
    document.getElementById('loginBtn').addEventListener('click', async () => {
        try {
            const res = await fetch(`${baseUrl}/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({
                    userId: 8,//æ”¹å®Œä¹‹åï¼Œåç«¯å’Œç½‘é¡µéƒ½è¦é‡æ–°å¯åŠ¨/åˆ·æ–°
                    password: '123456'
                })
            });

            if (!res.ok) throw new Error(`HTTPé”™è¯¯ï¼š${res.status}`);
            const data = await res.json();
            console.log('ç™»å½•å“åº”ï¼š', data);

            if (data.code === 200 && data.data?.accessToken) {
                const token = data.data.accessToken;
                localStorage.setItem('token', token);
                document.getElementById('result').textContent = `âœ… ç™»å½•æˆåŠŸï¼`;
            } else {
                document.getElementById('result').textContent = `âŒ ç™»å½•å¤±è´¥ï¼š${data.message || 'æœªçŸ¥é”™è¯¯'}`;
            }
        } catch (err) {
            document.getElementById('result').textContent = `âŒ ç™»å½•å‡ºé”™ï¼š${err}`;
        }
    });

    // è·å–ç”¨æˆ·åˆ—è¡¨é€»è¾‘
    document.getElementById('fetchBtn').addEventListener('click', async () => {
        const token = localStorage.getItem('token');
        if (!token) {
            document.getElementById('result').textContent = 'âŒ å…ˆç™»å½•ï¼';
            return;
        }

        try {
            const res = await fetch(`${baseUrl}/findAll`, {
                credentials: 'include',
                headers: {
                    'Access-Token': token // å’Œæ‹¦æˆªå™¨/è·¨åŸŸé…ç½®ä¸€è‡´
                }
            });

            if (!res.ok) throw new Error(`HTTPé”™è¯¯ï¼š${res.status}`);
            const data = await res.json();
            document.getElementById('result').textContent = JSON.stringify(data, null, 2);
        } catch (err) {
            document.getElementById('result').textContent = `âŒ è¯·æ±‚å‡ºé”™ï¼š${err}`;
        }
    });
</script>
</body>
</html>